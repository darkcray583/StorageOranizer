<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaultStore | Premium Organizer</title>
    <style>
        :root {
            --bg: #f5f3ff;
            --card-bg: #ffffff;
            --text-main: #4c1d95;
            --text-muted: #7c3aed;
            --primary: #8b5cf6;
            --primary-hover: #7c3aed;
            --danger: #f87171;
            --border: #ddd6fe;
            --input-bg: #ffffff;
            --accent: #ede9fe;
        }

        [data-theme="dark"] {
            --bg: #1e1b4b;
            --card-bg: #2e1065;
            --text-main: #ddd6fe;
            --text-muted: #a78bfa;
            --primary: #c084fc;
            --primary-hover: #a855f7;
            --border: #4c1d95;
            --input-bg: #4c1d95;
            --accent: #5b21b6;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            transition: all 0.4s ease;
        }

        .navbar {
            background: var(--card-bg);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo { font-size: 1.8rem; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; }

        .container { max-width: 1100px; margin: 2rem auto; padding: 0 20px; }

        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) { .main-layout { grid-template-columns: 1fr; } }

        .card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(124, 58, 237, 0.1);
            border: 1px solid var(--border);
            height: fit-content;
            margin-bottom: 1rem;
        }

        label { display: block; font-size: 0.75rem; font-weight: 700; margin-bottom: 6px; text-transform: uppercase; color: var(--text-muted); }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--input-bg);
            color: var(--text-main);
            margin-bottom: 1rem;
            box-sizing: border-box;
            outline: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }

        .custom-cat-row { display: flex; gap: 8px; margin-bottom: 1rem; }
        .btn-small { padding: 0 15px; background: var(--accent); color: var(--primary); border: none; border-radius: 10px; font-weight: 700; cursor: pointer; }
        
        .manage-list { list-style: none; padding: 0; margin-top: 1rem; }
        .manage-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 8px 0; 
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .del-cat { color: var(--danger); cursor: pointer; font-weight: bold; border: none; background: none; }

        .filter-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 2rem;
        }

        @media (max-width: 600px) { .filter-bar { grid-template-columns: 1fr; } }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }

        .item-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 18px;
            overflow: hidden;
            transition: 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .img-container { width: 100%; height: 180px; overflow: hidden; background: var(--accent); cursor: zoom-in; }
        .img-preview { width: 100%; height: 100%; object-fit: cover; }

        .item-content { padding: 15px; flex-grow: 1; }
        .item-name { font-weight: 800; font-size: 1.1rem; color: var(--text-main); display: block; margin-bottom: 5px; }
        .item-loc { font-size: 0.85rem; color: var(--text-muted); font-weight: 600; }

        .badge {
            margin-top: 10px;
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent);
            color: var(--primary);
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 800;
        }

        .btn-delete {
            position: absolute;
            top: 10px; right: 10px;
            background: rgba(239, 68, 68, 0.9);
            color: white; border: none; border-radius: 8px;
            width: 30px; height: 30px; cursor: pointer; z-index: 5;
        }

        .modal {
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center; align-items: center;
        }
        .modal-content { max-width: 90%; max-height: 90%; border-radius: 15px; }

        .theme-btn { background: var(--accent); border: none; padding: 10px 15px; border-radius: 12px; color: var(--primary); font-weight: 700; cursor: pointer; }
    </style>
</head>
<body data-theme="light">

<div id="imageModal" class="modal" onclick="closeModal()">
    <img class="modal-content" id="modalImg">
</div>

<nav class="navbar">
    <div class="logo">VaultStore</div>
    <button class="theme-btn" onclick="toggleTheme()">‚ú® Switch Theme</button>
</nav>

<div class="container">
    <div class="main-layout">
        <div>
            <div class="card">
                <h2 style="margin-top:0; color:var(--primary)">Add Item</h2>
                <label>Item Name</label>
                <input type="text" id="itemName" placeholder="e.g. Air Fryer">
                
                <label>Category</label>
                <select id="categorySelect"></select>

                <label>Box Name / Room</label>
                <input type="text" id="containerName" placeholder="e.g. Kitchen Cabinet">

                <label>Photo (Optional)</label>
                <input type="file" id="itemImage" accept="image/*">

                <button class="btn-primary" onclick="processAndAdd()">Add to Vault</button>
            </div>

            <div class="card">
                <label>Manage Categories</label>
                <div class="custom-cat-row">
                    <input type="text" id="newCatName" placeholder="New Category Name..." style="margin-bottom:0;">
                    <button class="btn-small" onclick="addNewCategory()">Add</button>
                </div>
                <ul id="manageList" class="manage-list"></ul>
            </div>
        </div>

        <div>
            <div class="filter-bar">
                <input type="text" id="searchName" onkeyup="runFilters()" placeholder="üîç Search Item Name...">
                <input type="text" id="searchLoc" onkeyup="runFilters()" placeholder="üìç Search Room/Box...">
                <select id="filterCat" onchange="runFilters()"></select>
            </div>
            <div id="inventoryList" class="inventory-grid"></div>
        </div>
    </div>
</div>

<script>
    let inventory = JSON.parse(localStorage.getItem('vaultData')) || [];
    const defaultCategories = [
        "üì¶ General Storage", "üëï Clothes", "üéÑ Holiday", "üç≥ Kitchen", "üß∏ Toys & Games", "üîå Electronics", "üõ†Ô∏è Tools"
    ];
    let categories = JSON.parse(localStorage.getItem('vaultCategories')) || defaultCategories;

    window.onload = () => { updateCategoryMenus(); runFilters(); };

    function toggleTheme() {
        const body = document.body;
        body.setAttribute('data-theme', body.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
    }

    function openModal(imgSrc) {
        document.getElementById('imageModal').style.display = 'flex';
        document.getElementById('modalImg').src = imgSrc;
    }

    function closeModal() { document.getElementById('imageModal').style.display = 'none'; }

    function addNewCategory() {
        const catInput = document.getElementById('newCatName');
        const val = catInput.value.trim();
        if(!val) return;
        const emojiRegex = /\p{Emoji}/u;
        const formattedVal = emojiRegex.test(val) ? val : "üè∑Ô∏è " + val;
        if(!categories.includes(formattedVal)) {
            categories.push(formattedVal);
            localStorage.setItem('vaultCategories', JSON.stringify(categories));
            updateCategoryMenus();
            catInput.value = '';
        }
    }

    function deleteCategory(catName) {
        if(defaultCategories.includes(catName)) return alert("Default categories are locked.");
        if(confirm(`Delete "${catName}"?`)) {
            categories = categories.filter(c => c !== catName);
            localStorage.setItem('vaultCategories', JSON.stringify(categories));
            updateCategoryMenus();
            runFilters();
        }
    }

    function updateCategoryMenus() {
        const addSelect = document.getElementById('categorySelect');
        const filterSelect = document.getElementById('filterCat');
        const manageList = document.getElementById('manageList');
        addSelect.innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
        filterSelect.innerHTML = `<option value="All">All Categories</option>` + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        manageList.innerHTML = categories.map(c => `
            <li class="manage-item">
                <span>${c}</span>
                ${!defaultCategories.includes(c) ? `<button class="del-cat" onclick="deleteCategory('${c}')">‚úï</button>` : `<small style="color:var(--text-muted)">Locked</small>`}
            </li>
        `).join('');
    }

    function processAndAdd() {
        const name = document.getElementById('itemName').value;
        const cat = document.getElementById('categorySelect').value;
        const loc = document.getElementById('containerName').value;
        const file = document.getElementById('itemImage').files[0];
        if (!name || !loc) return alert("Enter name and location.");
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => addItem(name, cat, loc, e.target.result);
            reader.readAsDataURL(file);
        } else { addItem(name, cat, loc, null); }
    }

    function addItem(name, category, container, imageSrc) {
        inventory.push({ id: Date.now(), name, category, container, imageSrc });
        localStorage.setItem('vaultData', JSON.stringify(inventory));
        document.getElementById('itemName').value = '';
        document.getElementById('containerName').value = '';
        document.getElementById('itemImage').value = '';
        runFilters();
    }

    function deleteItem(id) {
        if(confirm("Delete this item?")) {
            inventory = inventory.filter(i => i.id !== id);
            localStorage.setItem('vaultData', JSON.stringify(inventory));
            runFilters();
        }
    }

    function runFilters() {
        const nameQ = document.getElementById('searchName').value.toLowerCase();
        const locQ = document.getElementById('searchLoc').value.toLowerCase();
        const catQ = document.getElementById('filterCat').value;
        const filtered = inventory.filter(i => 
            i.name.toLowerCase().includes(nameQ) && 
            i.container.toLowerCase().includes(locQ) && 
            (catQ === 'All' || i.category === catQ)
        );
        displayItems(filtered);
    }

    function displayItems(items) {
        const list = document.getElementById('inventoryList');
        list.innerHTML = '';
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-card';
            let img = item.imageSrc ? `<div class="img-container" onclick="openModal('${item.imageSrc}')"><img src="${item.imageSrc}" class="img-preview"></div>` : '';
            div.innerHTML = `${img}<div class="item-content"><span class="item-name">${item.name}</span><span class="item-loc">üìç ${item.container}</span><br><span class="badge">${item.category}</span></div><button class="btn-delete" onclick="deleteItem(${item.id})">‚úï</button>`;
            list.appendChild(div);
        });
    }
</script>
</body>
</html>